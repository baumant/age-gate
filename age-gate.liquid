{% assign enter_date_of_birth = false %}<!-- enter_date_of_birth -->

{% assign backgroundUrl = "none" %}<!-- backgroundUrl -->

{% assign transparentModal = false %}<!-- transparentModal -->

{% assign logoUrl = "none" %}<!-- logoUrl -->

{% assign redirectUrl = "http://google.com" %}<!-- redirectUrl -->

{% assign age = 21 %}<!-- age variable -->

{% assign rememberDays = 14 %}<!-- rememberDays -->

{% assign dontShow = false %}<!-- dontShow -->

{% capture adult_header %}You must be of legal age to enter this site{% endcapture %}<!-- adult_header -->

{% capture adult_text %}This website contains adult material and is only suitable for those {{age}} years or older. Click Enter only if you are at least {{age}} years of age.{% endcapture %}<!-- adult_text -->

{% assign enterButtonText = "ENTER" %}<!-- enterButtonText -->

{% assign exitButtonText = "EXIT" %}<!-- exitButtonText -->

{% assign exitButton = true %}<!-- exitButton -->

{% assign isEmailCapture = true %}<!-- isEmailCapture -->

{% capture ec_title %}STAY UP TO DATE{% endcapture %}<!-- ec_title -->

{% assign ec_titlecolor = "rgb(255, 255, 255)" %}<!-- ec_titlecolor -->

{% capture ec_text %}Submit your email to get updates on products and special promotions.{% endcapture %}<!-- ec_text -->

{% assign ec_textcolor = "rgb(255, 255, 255)" %}<!-- ec_textcolor -->

{% assign designMode = true %}<!-- designMode -->

<div id="prompt-background">
  <div id="age-check-prompt" class="modal-prompt {% if transparentModal %}no-background{% endif %}">
    <h1>
      {{ adult_header }}
    </h1>
    {% if adult_text != "" %}
      <p>
        {{ adult_text }}
      </p>
    {% endif %}
    <div class="ag-dob-select" {% unless enter_date_of_birth %} style="display:none;"{% endunless %}>
      <select name="bmonth" id="bmonth"{% unless enter_date_of_birth %} value="1"{% endunless %}>
        {% if enter_date_of_birth %}
        <option value="1">- Month -</option>
        <option value="1">January</option>
        <option value="2">February</option>
        <option value="3">March</option>
        <option value="4">April</option>
        <option value="5">May</option>
        <option value="6">June</option>
        <option value="7">July</option>
        <option value="8">August</option>
        <option value="9">September</option>
        <option value="10">October</option>
        <option value="11">November</option>
        <option value="12">December</option>
        {% endif %}
      </select> 
      <select name="bday" id="bday"{% unless enter_date_of_birth %} value="1"{% endunless %}>
        {% if enter_date_of_birth %}
        <option value="1">- Day -</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        {% endif %}
      </select>
      <select name="byear" id="byear"{% unless enter_date_of_birth %} value="1950"{% endunless %}>
        {% if enter_date_of_birth %}
        <option value="3000">- Year -</option>
        <option value="2018">2018</option>
        <option value="2017">2017</option>
        <option value="2016">2016</option>
        <option value="2015">2015</option>
        <option value="2014">2014</option>
        <option value="2013">2013</option>
        <option value="2012">2012</option>
        <option value="2011">2011</option>
        <option value="2010">2010</option>
        <option value="2009">2009</option>
        <option value="2008">2008</option>
        <option value="2007">2007</option>
        <option value="2006">2006</option>
        <option value="2005">2005</option>
        <option value="2004">2004</option>
        <option value="2003">2003</option>
        <option value="2002">2002</option>
        <option value="2001">2001</option>
        <option value="2000">2000</option>
        <option value="1999">1999</option>
        <option value="1998">1998</option>
        <option value="1997">1997</option>
        <option value="1996">1996</option>
        <option value="1995">1995</option>
        <option value="1994">1994</option>
        <option value="1993">1993</option>
        <option value="1992">1992</option>
        <option value="1991">1991</option>
        <option value="1990">1990</option>
        <option value="1989">1989</option>
        <option value="1988">1988</option>
        <option value="1987">1987</option>
        <option value="1986">1986</option>
        <option value="1985">1985</option>
        <option value="1984">1984</option>
        <option value="1983">1983</option>
        <option value="1982">1982</option>
        <option value="1981">1981</option>
        <option value="1980">1980</option>
        <option value="1979">1979</option>
        <option value="1978">1978</option>
        <option value="1977">1977</option>
        <option value="1976">1976</option>
        <option value="1975">1975</option>
        <option value="1974">1974</option>
        <option value="1973">1973</option>
        <option value="1972">1972</option>
        <option value="1971">1971</option>
        <option value="1970">1970</option>
        <option value="1969">1969</option>
        <option value="1968">1968</option>
        <option value="1967">1967</option>
        <option value="1966">1966</option>
        <option value="1965">1965</option>
        <option value="1964">1964</option>
        <option value="1963">1963</option>
        <option value="1962">1962</option>
        <option value="1961">1961</option>
        <option value="1960">1960</option>
        <option value="1959">1959</option>
        <option value="1958">1958</option>
        <option value="1957">1957</option>
        <option value="1956">1956</option>
        <option value="1955">1955</option>
        <option value="1954">1954</option>
        <option value="1953">1953</option>
        <option value="1952">1952</option>
        <option value="1951">1951</option>
        <option value="1950">1950</option>
        <option value="1949">1949</option>
        <option value="1948">1948</option>
        <option value="1947">1947</option>
        <option value="1946">1946</option>
        <option value="1945">1945</option>
        <option value="1944">1944</option>
        <option value="1943">1943</option>
        <option value="1942">1942</option>
        <option value="1941">1941</option>
        <option value="1940">1940</option>
        <option value="1939">1939</option>
        <option value="1938">1938</option>
        <option value="1937">1937</option>
        <option value="1936">1936</option>
        <option value="1935">1935</option>
        <option value="1934">1934</option>
        <option value="1933">1933</option>
        <option value="1932">1932</option>
        <option value="1931">1931</option>
        <option value="1930">1930</option>
        <option value="1929">1929</option>
        <option value="1928">1928</option>
        <option value="1927">1927</option>
        <option value="1926">1926</option>
        <option value="1925">1925</option>
        <option value="1924">1924</option>
        <option value="1923">1923</option>
        <option value="1922">1922</option>
        <option value="1921">1921</option>
        <option value="1920">1920</option>
        <option value="1919">1919</option>
        <option value="1918">1918</option>
        <option value="1917">1917</option>
        <option value="1916">1916</option>
        <option value="1915">1915</option>
        <option value="1914">1914</option>
        <option value="1913">1913</option>
        <option value="1912">1912</option>
        <option value="1911">1911</option>
        <option value="1910">1910</option>
        <option value="1909">1909</option>
        <option value="1908">1908</option>
        <option value="1907">1907</option>
        <option value="1906">1906</option>
        <option value="1905">1905</option>
      {% endif %}
      </select>
      <div style="clear:both; margin-bottom:15px"></div>
    </div>
    <button id="submit_birthdate" class="button-enter btn styled-submit" onclick="ageCheck()" style="display:inline-block;">{{enterButtonText}}</button> 
    <a href="{{ redirectUrl }}" id="button-exit" {% if exitButton %}class="btn"{% endif %} name="button-exit">{{exitButtonText}}</a>
  </div>
  {% if logoUrl != 'none' %}
    <img src="{{logoUrl}}" id="age-verification-logo" alt="logo">
  {% endif %}
  <div id="age-verification-email-capture">
    <img src="https://cdn.shopify.com/s/files/1/0249/5761/6206/files/icon-times.svg?621" alt="" id="ec-close">
    <div class="ec-info">
      <h2 class="ec-title" style="color:{{ ec_titlecolor }}">{{ec_title}}</h2>
      <p class="ec-text" style="color:{{ ec_textcolor }}">{{ec_text}}</p>
    </div>
    {% form 'customer', class: 'ec-form', novalidate: 'novalidate' %}
      <input type="hidden" name="contact[tags]" value="newsletter">
      <div class="input-group {% if form.errors %} input-group--error{% endif %}" id="ec-input-group">
        <input type="email"
          name="contact[email]"
          id="ec-form-email"
          class="input-group__field newsletter__input{% if form.errors %} input--error{% endif %}"
          value="{{ form.email }}"
          placeholder="{{ 'general.newsletter_form.email_placeholder' | t }}"
          aria-label="{{ 'general.newsletter_form.email_placeholder' | t }}"
          aria-required="true"
          required
          autocorrect="off"
          autocapitalize="off"
          {% if form.errors %}
            aria-invalid="true"
            aria-describedby="ec-form-email-error"
            data-form-status
          {% endif %}>
        <span class="input-group__btn">
          <button type="submit" class="btn newsletter__submit" name="commit" id="Subscribe">
            <span class="newsletter__submit-text--large">{{ 'general.newsletter_form.submit' | t }}</span>
          </button>
        </span>
      </div>
      {% if form.errors contains 'email' %}
        <span id="ec-form-email-error" class="input-error-message">
          {% include 'icon-error' %} {{ form.errors.translated_fields['email'] | capitalize }} {{ form.errors.messages['email'] }}.
        </span>
      {% endif %}
      {%- if form.posted_successfully? -%}
        <p class="form-message form-message--success" tabindex="-1" data-form-status>
          {{ 'general.newsletter_form.confirmation' | t }}
        </p>
      {%- endif -%}
    {% endform %}
  </div>
</div>

<script>
/*
Disallow scrolling on body when age gate is up and display age verification, pulled in from scriptTag for easy shopify uninstall

document.body.className += ' ' + 'noscroll';
document.getElementById('prompt-background').style.display = 'flex';
*/

// hide age check after it fades out, fade in email capture
document.getElementById('prompt-background').addEventListener('transitionend', function(e) {
  if (e.target == document.getElementById('prompt-background') && (e.propertyName === 'height')) {
    showEmailCapture();
  }
});
function showEmailCapture(){
  document.getElementById('age-check-prompt').style.display = 'none';
  var emailCapture = document.getElementById('age-verification-email-capture');
  emailCapture.style.display = 'flex';
  setTimeout(function(){ 
    emailCapture.style.opacity = 1;
    emailCapture.style.paddingTop = '0px';
  }, 300);
}
// close email capture functions
document.getElementById('ec-close').addEventListener('click', function(e) {
  document.getElementById('prompt-background').style.height = '0%';
  var days = {{rememberDays}};
  var date = new Date();
  date.setTime(date.getTime()+(days*24*60*60*1000));
  var expires = "; expires="+date.toGMTString();
  document.cookie = 'emailcaptured=true;'+expires+"; path=/";
  
  setTimeout(function(){ 
    document.getElementById('prompt-background').style.display = 'none';
  }, 350);
});

document.getElementsByClassName("ec-form")[0].addEventListener("submit", ecFormSubmit);
  
function ecFormSubmit(e){
  var emailInput = document.getElementById('ec-form-email').value;
  if(emailInput === ''){
    e.preventDefault();
    
    var target = document.querySelector('#ec-input-group');
    target.classList.add('input-group--error');
    var errorEmailInput = document.querySelector('#ec-form-email');
    errorEmailInput.classList.add('input--error');
    if(document.querySelector('#ec-form-email-error') != null){
      document.querySelector('#ec-form-email-error').remove();
    }
    if(document.querySelector('.form-message') != null){
      document.querySelector('.form-message').remove();
    }

    var errorMessage = document.createElement('span');
    errorMessage.innerHTML = 'Please enter an email address';
    errorMessage.classList.add('input-error-message');
    errorMessage.setAttribute("id", "ec-form-email-error");
    target.parentNode.insertBefore( errorMessage, target.nextSibling );
  }
}

function ageCheck() {
  var min_age = {{ age }};
  var year =   parseInt(document.getElementById('byear').value);
  var month =  parseInt(document.getElementById('bmonth').value);
  var day =    parseInt(document.getElementById('bday').value);
  var theirDate = new Date((year + min_age), month, day);
  var today = new Date;
  if ((today.getTime() - theirDate.getTime()) < 0) {
    window.location = '{{ redirectUrl }}';
  } else {
    var days = {{rememberDays}};
    var date = new Date();
    date.setTime(date.getTime()+(days*24*60*60*1000));
    var expires = "; expires="+date.toGMTString();
    if( {{designMode}} == false ){
      document.cookie = 'twentyone=true;'+expires+"; path=/";
    }
    document.body.className = document.body.className.replace("noscroll","");
    
    if( {{ isEmailCapture }} ){
      // will trigger showEmailCapture()
      document.getElementById('prompt-background').classList.add('ec-height');
    } else {
      location.reload();
    }
  };
};

function readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for(var i=0;i < ca.length;i++) {
    var c = ca[i];
    while (c.charAt(0)==' ') c = c.substring(1,c.length);
    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
  }
  return null;
};

var twentyone = readCookie('twentyone');
var emailcaptured = readCookie('emailcaptured');

if (twentyone) {
  // remove noscroll class if user is over 21, hide age gate
  document.body.className = document.body.className.replace("noscroll","");

  if( {{ isEmailCapture }} && emailcaptured == null ){
    document.getElementById('prompt-background').classList.add('ec-height');
    showEmailCapture();
  } else {
    document.write("<style> #prompt-background { display: none !important; }</style>");
  }
};

</script>

<style>
body.noscroll {
  overflow: hidden !important;
}
#age-verification-logo{
  position: absolute;
  bottom: 7%;
  right: 7%;
  opacity: 1;
  transition: opacity 0.3s ease-in-out;
  max-height: 100px;
}
@media screen and (max-width: 768px){
  #age-verification-logo{
    right: calc(90% - 56px);
  }
}
.modal-prompt {
  background: #fff;
  border-radius: 2px;
  box-shadow: 0px 0px 10px rgba(0,0,0,0.5);
  width: 440px;
  height: auto;
  margin: 0 auto;
  padding: 20px 30px 30px 30px;
  position: relative;
  z-index: 1000000;
  opacity: 1;
  transition: opacity 0.3s ease-in;
}
@media screen and (max-width: 768px){
  .modal-prompt{
    width: 80%;
    margin: 0 auto;
    padding: 10px;
  }
}
.modal-prompt.no-background{
  background: transparent;
  box-shadow: none;
}
@media screen and (max-width: 768px){
  .modal-prompt.no-background{
    padding: 0;
  }
}
.ag-dob-select{
  display: flex;
  margin-bottom:20px;
}
@media screen and (max-width: 500px){
  .ag-dob-select select{
    margin-top: 5px;
    margin-bottom: 5px;
  }
}

#prompt-background {
  background: url({{ backgroundUrl }}) no-repeat center center fixed #555;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
  width: 100%;
  height: 100%;
  position: fixed;
  left: 0;
  bottom: 0;
  z-index: 9999999;
  display: none;
  align-items: center;
  transition:height 0.3s linear;
}
#prompt-background.ec-height{
  height: 20%;
}
@media screen and (max-width: 768px){
  #prompt-background.ec-height{
    height: 40%;
    align-items: stretch;
  }
}

#prompt-background.ec-height #age-check-prompt {
  opacity: 0;
}
#prompt-background.ec-height #age-verification-logo {
  opacity: 0;
}
  
.modal-prompt select { float: left; margin-right: 10px; }
  
#age-verification-email-capture{
  width: 100%;
  justify-content: space-around;
  align-items: center;
  display: none;
  opacity: 0;
  padding-top: 30px;
  transition: all 0.3s ease-in-out;
  position: relative;
}
@media screen and (max-width: 768px){
  #age-verification-email-capture{
    flex-wrap: wrap;
  }
}
#age-verification-email-capture #ec-close{
  position: absolute;
  top: -10px;
  right: 15px;
  cursor: pointer;
}
@media screen and (max-width: 768px){
  #age-verification-email-capture #ec-close{
    top: 0;
    position: relative;
    display: block;
    margin: 10px 0 0 100%;
  }
}
#age-verification-email-capture .ec-info{
  max-width: 50%;
}
#age-verification-email-capture .ec-info .ec-text{
  font-size: 24px;
}
#age-verification-email-capture .ec-form .input-group{
  flex-wrap: nowrap;
}
@media screen and (max-width: 768px){
  #age-verification-email-capture .ec-info, #age-verification-email-capture .ec-form{
    max-width: 90%;
    margin: 10px 0;
  }
}

</style>